<!-- User Story #1: My portfolio should have a welcome section with an id of welcome-section.

User Story #2: The welcome section should have an h1 element that contains text.

User Story #3: My portfolio should have a projects section with an id of projects.

User Story #4: The projects section should contain at least one element with a class of project-tile to hold a project.

User Story #5: The projects section should contain at least one link to a project.

User Story #6: My portfolio should have a navbar with an id of navbar.

User Story #7: The navbar should contain at least one link that I can click on to navigate to different sections of the page.

User Story #8: My portfolio should have a link with an id of profile-link, which opens my GitHub or FCC profile in a new tab.

User Story #9: My portfolio should have at least one media query.

User Story #10: The height of the welcome section should be equal to the height of the viewport.

User Story #11: The navbar should always be at the top of the viewport. -->

<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- D3 Setup -->
    <html xmlns:xlink="http://www.w3.org/1999/xlink">
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <!-- Font Awesome for social icons -->
    <script src="https://kit.fontawesome.com/374cfc1460.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <!-- local stylesheet -->
    <link rel="stylesheet" href="style.css">

    <title>Hello, world!</title>
</head>

<body>

    <nav class="navbar navbar-expand-lg navbar-light bg-light" id="navbar">
        <a class="navbar-brand" href="#">Ethan Merrill</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="#">Introduction <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#projects">Projects</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#profile-links">Profile Links</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#contact">Contact</a>
                </li>
            </ul>
        </div>
    </nav>

    <section id="welcome-section">
        <div id="container" class="svg-container">
            <svg id='chart' xmlns:xlink="http://www.w3.org/1999/xlink"></svg>
        </div>
        <h1>Hi, I'm Ethan</h1>
    </section>

    <section id="projects">
        <h1>Projects</h1>
        <div class="project-links-container">
            <a href="link.com">
                <div class="card project-tile" style="width: 18rem;">
                    <!-- <img src="..." class="card-img-top" alt="..."> -->
                    <div class="card-body">
                        <h5 class="card-title project-title">Card title</h5>
                        <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
                        <a href="#" class="btn btn-primary">Go somewhere</a>
                    </div>
                </div>
            </a>
        </div>
    </section>

    <section id="profile-links">
        <h1>Profile Links</h1>
        <div class="profile-links-container">
            <a id="profile-link" href="https://github.com/EthanMerrill" target="_blank"><i class="fab fa-github fa-3x"></i></a>
        </div>
    </section>

    <section id="contact">
        <h1>Contact</h1>
        <div></div>
    </section>
    <!-- Width: <output id="width">0</output><br> Height: <output id="height">0</output><br>
    <textarea id="textbox">Resize me</textarea><br> -->

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
    <script src="https://cdn.freecodecamp.org/testable-projects-fcc/v1/bundle.js"></script>

</body>

</html>
<script>
    d3.json("graphData.json").then(function(data) {
        // console.log(data)
        buildNetwork(data)
    })

    // function outputsize() {
    //     width.value = chart.width.animVal.value
    //     height.value = chart.height.animVal.value
    // }
    // outputsize()

    // new ResizeObserver(outputsize).observe(chart)

    // var svg = d3.select('svg')




    drag = simulation => {

        function dragstarted(event) {
            if (!event.active) simulation.alphaTarget(.5).restart();
            event.subject.fx = event.subject.x;
            event.subject.fy = event.subject.y;
        }

        function dragged(event) {
            event.subject.fx = event.x;
            event.subject.fy = event.y;
        }

        function dragended(event) {
            if (!event.active) simulation.alphaTarget(0);
            event.subject.fx = null;
            event.subject.fy = null;
        }

        return d3.drag()
            .on("start", dragstarted)
            .on("drag", dragged)
            .on("end", dragended);
    }



    function buildNetwork(data) {

        function linkFinder(data) {
            node_links = []
            nodes.forEach(function linkMaker(nodes) {
                    // console.log(nodes.id)

                    if (typeof nodes.links !== 'undefined') {
                        // node_links.push(nodes.links)
                        // console.log(nodes.links[0].source)
                        nodes.links.forEach(function linkchecker(onelink) {
                            if (typeof onelink.source == 'undefined') {
                                onelink.source = nodes.id
                            }
                            if (typeof onelink.value == 'undefined') {
                                if (nodes.group == 'page') {
                                    onelink.value = 10;
                                } else if (nodes.group == 'subcategory') {
                                    onelink.value = 14;
                                } else {
                                    onelink.value = 20;
                                }
                            }
                            console.log(onelink.source)
                            node_links.push(onelink)
                        })

                    }
                })
                // console.log(node_links)

            return node_links
        }


        const nodes = data.nodes.map(d => Object.create(d));

        const links = linkFinder().map(d => Object.create(d))

        const labelsNodes = data.nodes.map(d => Object.create(d));


        // console.log(data.links.map(d => Object.create(d)))
        // console.log(links2().map(d => Object.create(d)))
        // console.log(links)




        var width = document.getElementById('chart').width.animVal.value;
        var height = document.getElementById('chart').height.animVal.value;
        var svg = d3.select('svg')
            // width = +svg.attr("width"),
            // height = +svg.attr("height");

        var attractForce = d3.forceManyBody().strength(1).distanceMax(200).distanceMin(10);
        var repelForce = d3.forceManyBody().strength(-150).distanceMax(600).distanceMin(1);

        const simulation = d3.forceSimulation(nodes)
            .force("link", d3.forceLink(linkFinder()).id(d => d.id).distance(function(d) {
                return (d.value) ** 1.8;
            }).strength(0.4))
            .force("charge", d3.forceManyBody())
            .force("attractForce", attractForce)
            .force("repelForce", repelForce)
            .velocityDecay(.2);

        // .force("center", d3.forceCenter(100 / 2, 100 / 2));

        const link = svg.append("g")
            .attr("class", "links")
            .attr("stroke", "#999")
            .attr("stroke-opacity", 0.6)
            .selectAll("line")
            .data(links)
            .join("line")
            .attr("stroke-width", d => Math.sqrt(d.value));

        const node = svg.append('g')
            .attr('class', "nodes")
            .selectAll(".node")
            .data(nodes)
            .join('g')
            .attr("class", "node")
            .call(drag(simulation));

        var hyperlink = node.append("svg:a")
            // .text(function(d) {
            //     return d.id;
            // })
            .attr("xlink:href", function(d) {
                return ("xlink:href", d.url)
            })
            .attr('class', "hyperlink")


        const text = hyperlink.append('text')
            .text(function(d) {
                return d.id;
            })
            .style('fill', '#000')
            .style('font-size', '14px')
            .attr("text-anchor", "middle")
            .attr('x', 0)
            .attr('y', (d => radius(d.group) + 21))

        // const circleOrIcon = hyperlink.append('text')
        //     .attr("class", function(d) {
        //         console.log(d.icons)
        //         if (typeof(d.icon) !== "undefined") {
        //             return icon(d)
        //         } else {
        //             return circle(d)
        //         }
        //     })

        // const icon = node.append('text')
        //     .attr('font-family', 'FontAwesome')
        //     // .attr("class", "fab fa-accessible-icon")
        //     .attr("text-anchor", "middle")
        //     .attr('alignment-baseline', "middle")
        //     .attr('font-size', 25)
        //     .text(function(d) {
        //         return '\uf159'
        //     });
        const circles = hyperlink.append("circle")
            .filter(function(d) {
                return ((d.group == "page") || (d.group == "Ethan"))
            })
            .attr("class", "circle")
            .attr("stroke", d => border(d.group))
            .attr("stroke-width", 1.5)
            .attr("r", d => radius(d.group))
            .attr("fill", d => color(d.group))
            // .attr("fill", "red")
            .attr("opacity", .5)
            .on("mouseover", mouseOver)
            .on("mouseleave", mouseLeave)



        const icons = hyperlink.append('icon')
            // .attr('class', 'handle')
            .attr('font-family', 'FontAwesome')
            .attr("text-anchor", "middle")
            .attr('alignment-baseline', "middle")
            .attr('width', 28)
            .attr('height', 28)
            .attr('x', -10)
            .attr('y', -10)
            .attr("class", d => d.icon)




        simulation.on("tick", () => {
            link

                .attr("x1", d => Math.max(80, Math.min(width - 80, d.source.x)))
                .attr("y1", d => Math.max(radius(d.group), Math.min(height, d.source.y)))
                .attr("x2", d => Math.max(80, Math.min(width - 80, d.target.x)))
                .attr("y2", d => Math.max(radius(d.group), Math.min(height, d.target.y)));
            node
                .attr("transform", d => `translate(${Math.max(radius(d.group), Math.min(width-radius(d.group),d.x))}, ${Math.max(radius(d.group), Math.min(height-radius(d.group),d.y))})`);

        });

        width, height = resize();
        d3.select(window).on("resize", resize);


        function resize() {
            width = window.innerWidth, height = window.innerHeight;
            svg.attr("width", width).attr("height", height);
            // console.log(width, height)
            simulation.force("center", d3.forceCenter(width / 2, height / 2)).restart();
            return svg.attr("width"), svg.attr('height')
        }

        return svg.node();
    };



    color = d3.scaleOrdinal(["Blue", "Red", "green", "orange"])

    radius = d3.scaleOrdinal([50, 25, 20, 8])

    function border(group) {
        if (group == 'page') {
            return 'red'
        }
        return "blue"
    }

    let mouseOver = function(d) {
        // console.log(this.getAttribute('r'))
        // Use D3 to select element, change color and size
        d3.select(this).attr(
            "r", (this.getAttribute('r') * 1.1)
        );
    }

    let mouseLeave = function(d) {
        // console.log(this.getAttribute('r'))
        // Use D3 to select element, change color and size
        d3.select(this).attr(
            "r", (this.getAttribute('r') * .9)
        );
    }

    // https://bl.ocks.org/mbostock/3355967
</script>